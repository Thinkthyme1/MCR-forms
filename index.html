<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#1f2937" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' blob: data:; connect-src 'self'; font-src 'self'; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; form-action 'self'" />
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="stylesheet" href="styles.css" />
    <title>MCR Forms Offline</title>
  </head>
  <body>
    <div id="app" class="app">
      <section id="startupScreen" class="modal-screen" aria-live="polite">
        <div class="card">
          <h1>MCR Forms</h1>
          <p id="startupMessage">Preparing secure offline workspace...</p>
          <div id="startupActions" class="actions"></div>
        </div>
      </section>

      <section id="cacheWarning" class="warning hidden" role="alert"></section>

      <header class="top-panel" id="topPanel">
        <div id="panelContent" class="panel-content">
          <div class="panel-left">
            <div class="button-group" id="formNav">
              <button data-view="roi" type="button">ROI</button>
              <button data-view="notice" type="button">Notice of Privacy Practices</button>
            </div>
            <div class="button-group" id="infoNav">
              <button data-view="general" type="button">General Info</button>
              <button data-view="staff" type="button">Staff Info</button>
            </div>
          </div>
          <div class="button-group session-controls">
            <button id="panelChevron" class="chevron" aria-expanded="true" aria-controls="panelContent">Hide Panel ▲</button>
            <div class="session-action-row">
              <button id="lockBtn" type="button" class="hidden">Lock</button>
              <div class="hold-wrap">
                <div id="deleteProgress" class="hold-progress"></div>
                <button id="deletePhiBtn" type="button" class="danger">Delete PHI</button>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main id="mainContent" class="main-content">
        <div id="pdfActionWrap" class="pdf-action hidden">
          <button id="createPdfBtn" class="roi-top-action-btn" type="button">Create PDF</button>
        </div>

        <section id="viewGeneral" class="view hidden">
          <h2>General Info</h2>
          <label>Customer First Name <input id="generalFirstName" type="text" autocomplete="off" /></label>
          <label>Customer Last Name <input id="generalLastName" type="text" autocomplete="off" /></label>
          <label>Date of Birth <input id="generalDob" type="date" /></label>
        </section>

        <section id="viewStaff" class="view hidden">
          <h2>Staff Info</h2>
          <label>First Name <input id="staffFirstName" type="text" autocomplete="off" /></label>
          <label>Last Name <input id="staffLastName" type="text" autocomplete="off" /></label>
          <label>Title/Relationship <input id="staffRole" type="text" autocomplete="off" /></label>
          <div id="dirPickerWrap" class="hidden">
            <button id="pickFolderBtn" type="button">Choose Default Save Folder</button>
            <p id="folderStatus" class="muted"></p>
          </div>
        </section>

        <section id="viewRoi" class="view hidden">
          <div class="view-header">
            <h2>Release of Information</h2>
            <div class="roi-switcher">
              <label for="roiSelect">ROI Instance</label>
              <select id="roiSelect" aria-label="Select ROI instance"></select>
              <button id="addRoiBtn" class="roi-action-btn roi-top-action-btn" type="button">Add New ROI</button>
            </div>
          </div>

          <form id="roiForm" class="form-card" autocomplete="off">
            <div class="roi-top-row">
              <div class="roi-logo-slot" aria-label="Company logo area">
                <img src="assets/benchmark-logo.svg" alt="Benchmark Human Services logo" class="roi-logo-img" />
              </div>
              <div class="roi-client-meta">
                <p class="readonly-line roi-client-name"><span id="roiClientName"></span></p>
                <p class="readonly-line"><strong>DOB:</strong> <span id="roiClientDob"></span></p>
              </div>
            </div>

            <h3 class="roi-auth-title">AUTHORIZATION FOR RELEASE OF INFORMATION – STANDARD REQUEST</h3>

            <section class="roi-route-grid" aria-label="ROI routing section">
              <div class="roi-route-col roi-route-left">
                <div class="roi-route-inset">
                  <label class="roi-route-mark">
                    <input id="roiLeftTo" class="route-toggle" type="checkbox" checked />
                    <span class="radio-filled" aria-hidden="true"></span>
                    <span>To</span>
                  </label>
                  <label class="roi-route-mark">
                    <input id="roiLeftFrom" class="route-toggle" type="checkbox" checked />
                    <span class="radio-filled" aria-hidden="true"></span>
                    <span>From</span>
                  </label>
                </div>
                <div class="roi-route-company-block">
                  <p class="roi-route-company">Benchmark Human Services</p>
                  <p class="roi-route-contact">530 West Thomas Street, Suite C</p>
                  <p class="roi-route-contact">Milledgeville, GA 31061</p>
                  <p class="roi-route-contact">(478) 451-0557</p>
                </div>
              </div>

              <div class="roi-route-col roi-route-right">
                <div class="roi-route-inset">
                  <label class="roi-route-mark">
                    <input id="roiRightTo" class="route-toggle" type="checkbox" checked />
                    <span class="radio-filled" aria-hidden="true"></span>
                    <span>To</span>
                  </label>
                  <label class="roi-route-mark">
                    <input id="roiRightFrom" class="route-toggle" type="checkbox" checked />
                    <span class="radio-filled" aria-hidden="true"></span>
                    <span>From</span>
                  </label>
                </div>
                <div class="roi-route-fields">
                  <label>Agency <input id="roiOrganization" type="text" /></label>
                  <label>C/O <input id="roiCareOf" type="text" /></label>
                  <label>Address <textarea id="roiAddress" rows="3"></textarea></label>
                  <label>Phone <input id="roiPhone" type="tel" /></label>
                  <label>Fax <input id="roiFax" type="tel" /></label>
                </div>
              </div>
            </section>
            <hr class="roi-route-hr" />

            <section class="roi-initials-block" aria-label="ROI initials authorization section">
              <p class="roi-initials-title">Initial the appropriate space below:</p>
              <p class="roi-initial-text">the following type(s) of information from my records (and any specific portion thereof):</p>

              <div class="roi-initial-row">
                <div class="roi-initial-boxes">
                  <input id="roiInit1A" class="roi-initial-input" type="text" maxlength="4" autocomplete="off" />
                </div>
                <p class="roi-initial-text">
                  I authorize the disclosure of alcohol or drug abuse information, if any.
                </p>
              </div>

              <div class="roi-initial-row">
                <div class="roi-initial-boxes">
                  <input id="roiInit2A" class="roi-initial-input" type="text" maxlength="4" autocomplete="off" />
                </div>
                <p class="roi-initial-text">
                  I authorize the disclosure of information, if any, concerning testing for HIV (human immunodeficiency virus) and/or treatment
                  for HIV or AIDS (acquired immune deficiency syndrome) and any related conditions.
                </p>
              </div>
            </section>
            <hr class="roi-route-hr" />

            <label>Purpose of Disclosure <input id="roiPurpose" type="text" /></label>

            <div class="roi-terms-block">
              <p class="roi-term-item">
                1. I understand that the information disclosed pursuant to this Authorization may be subject to re-disclosure by the recipient
                and no longer protected by federal privacy regulations or other applicable state or federal laws (except as set forth in
                paragraph 2 below).
              </p>
              <p class="roi-term-item">
                2. I understand that, pursuant to 42 C.F.R. Part 2, substance use disorder records disclosed under this Authorization are
                subject to federal confidentiality protections. Depending on the recipient, these records may be re-disclosed in accordance
                with the HIPAA Privacy Rule or may require my written consent for any further re-disclosure. These records may not be used
                in any civil, criminal, administrative, or legislative proceeding against me without my specific written consent or a court
                order. Violations may result in civil and criminal penalties under federal law.
              </p>
              <p class="roi-term-item">
                3. I understand that the Department of Behavioral Health and Developmental Disabilities will not condition my treatment,
                payment, or eligibility for any applicable benefits on whether I provide authorization for the requested release of information.
              </p>
              <p class="roi-term-item">
                4. I intend this document to be a valid authorization conforming to all requirements of the Privacy Rule and State law, and
                understand that my authorization will remain in effect for: (PLEASE CHECK ONE)
              </p>
              <div class="roi-duration-options">
                <label class="roi-duration-option">
                  <input id="roiDurationOneYear" class="route-toggle" type="radio" name="roiDuration" />
                  <span class="radio-filled" aria-hidden="true"></span>
                  <span>one (1) year.</span>
                </label>
                <label class="roi-duration-option">
                  <input id="roiDurationServicePeriod" class="route-toggle" type="radio" name="roiDuration" checked />
                  <span class="radio-filled" aria-hidden="true"></span>
                  <span>the period necessary to complete all transactions on matters related to services provided to me.</span>
                </label>
              </div>
            </div>

            <h3>Signature of Individual/Consumer/Patient/Applicant</h3>
            <canvas id="roiSignature" class="signature-pad" width="640" height="180"></canvas>
            <div class="signature-actions signature-meta-row">
              <button id="clearRoiSigBtn" class="roi-action-btn" type="button">Clear Signature</button>
              <p>Print Name: <span id="roiClientPrintedName"></span></p>
              <p>Date: <span id="roiClientDate"></span></p>
            </div>

            <h3>Signature of Parent or Other Legally Authorized Representative (where applicable)</h3>
            <canvas id="roiParentSignature" class="signature-pad" width="640" height="180"></canvas>
            <div class="signature-actions signature-meta-row">
              <button id="clearRoiParentSigBtn" class="roi-action-btn" type="button">Clear Parent/Representative Signature</button>
              <label class="roi-inline-box">Parent/Guardian/Custodian
                <input id="roiParentPrintedName" type="text" autocomplete="off" />
              </label>
              <p>Date: <span id="roiParentDate"></span></p>
            </div>

          </form>
        </section>

        <section id="viewNotice" class="view hidden">
          <h2>Notice of Privacy Practices</h2>
          <form id="noticeForm" class="form-card" autocomplete="off">
            <p class="readonly-line"><strong>Client:</strong> <span id="noticeClientName"></span></p>
            <p class="readonly-line"><strong>DOB:</strong> <span id="noticeClientDob"></span></p>
            <p class="readonly-line"><strong>Staff:</strong> <span id="noticeStaffName"></span></p>

            <h3>Section 1 Summary</h3>
            <textarea id="noticeSummary1" rows="2"></textarea>
            <div class="legal-text" id="noticeLegal1"></div>

            <h3>Section 2 Summary</h3>
            <textarea id="noticeSummary2" rows="2"></textarea>
            <div class="legal-text" id="noticeLegal2"></div>

            <h3>Section 3 Summary</h3>
            <textarea id="noticeSummary3" rows="2"></textarea>
            <div class="legal-text" id="noticeLegal3"></div>

            <h3>Client Signature</h3>
            <canvas id="noticeSignature" class="signature-pad" width="640" height="180"></canvas>
            <div class="signature-actions">
              <button id="clearNoticeSigBtn" type="button">Clear Signature</button>
            </div>
            <div class="date-time-row">
              <label>Date <input id="noticeDate" type="date" /></label>
              <label>Time <input id="noticeTime" type="time" /></label>
            </div>
          </form>
        </section>
      </main>

      <section id="lockOverlay" class="lock-overlay hidden" aria-modal="true" role="dialog">
        <button id="continueBtn" class="continue-btn" type="button">Continue</button>
        <div id="unlockPrompt" class="unlock-prompt hidden">
          <h2>Enter PIN to Continue</h2>
          <input id="unlockPin" type="password" inputmode="numeric" pattern="[0-9]*" maxlength="6" autocomplete="off" />
          <div class="actions">
            <button id="unlockSubmit" type="button">Unlock</button>
            <button id="unlockCancel" type="button">Cancel</button>
          </div>
          <p id="unlockError" class="error"></p>
          <div id="forgotPinWrap" class="hidden">
            <div id="forgotProgress" class="hold-progress"></div>
            <button id="deleteFromLockBtn" class="danger" type="button">Delete case data and start over</button>
          </div>
        </div>
      </section>

      <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

      <!-- ROI Print-Ready Div (hidden, rendered by html2pdf) -->
      <div id="printRoi" class="print-ready" aria-hidden="true">
        <div class="pr-header">
          <img src="assets/benchmark-logo.svg" alt="" class="pr-logo" />
          <div class="pr-client-info">
            <p class="pr-client-name" id="prRoiClientName"></p>
            <p><strong>DOB:</strong> <span id="prRoiClientDob"></span></p>
          </div>
        </div>
        <h2 class="pr-title">AUTHORIZATION FOR RELEASE OF INFORMATION – STANDARD REQUEST</h2>
        <div class="pr-route-grid">
          <div class="pr-route-col">
            <p><span id="prRoiLeftTo" class="pr-check"></span> To &nbsp; <span id="prRoiLeftFrom" class="pr-check"></span> From</p>
            <p class="pr-company"><strong>Benchmark Human Services</strong></p>
            <p>530 West Thomas Street, Suite C</p>
            <p>Milledgeville, GA 31061</p>
            <p>(478) 451-0557</p>
          </div>
          <div class="pr-route-col">
            <p><span id="prRoiRightTo" class="pr-check"></span> To &nbsp; <span id="prRoiRightFrom" class="pr-check"></span> From</p>
            <p>Agency: <span id="prRoiOrganization"></span></p>
            <p>C/O: <span id="prRoiCareOf"></span></p>
            <p>Address: <span id="prRoiAddress"></span></p>
            <p>Phone: <span id="prRoiPhone"></span> &nbsp; Fax: <span id="prRoiFax"></span></p>
          </div>
        </div>
        <div class="pr-initials-section">
          <p class="pr-label">Initial the appropriate space below:</p>
          <div class="pr-initial-row">
            <span class="pr-initial-box" id="prRoiInit1a"></span>
            <span>I authorize the disclosure of alcohol or drug abuse information, if any.</span>
          </div>
          <div class="pr-initial-row">
            <span class="pr-initial-box" id="prRoiInit2a"></span>
            <span>I authorize the disclosure of information, if any, concerning testing for HIV (human immunodeficiency virus) and/or treatment for HIV or AIDS (acquired immune deficiency syndrome) and any related conditions.</span>
          </div>
        </div>
        <p class="pr-field"><span class="pr-label">Purpose of Disclosure:</span> <span id="prRoiPurpose"></span></p>
        <div class="pr-legal">
          <p>1. I understand that the information disclosed pursuant to this Authorization may be subject to re-disclosure by the recipient and no longer protected by federal privacy regulations or other applicable state or federal laws (except as set forth in paragraph 2 below).</p>
          <p>2. I understand that, pursuant to 42 C.F.R. Part 2, substance use disorder records disclosed under this Authorization are subject to federal confidentiality protections. Depending on the recipient, these records may be re-disclosed in accordance with the HIPAA Privacy Rule or may require my written consent for any further re-disclosure. These records may not be used in any civil, criminal, administrative, or legislative proceeding against me without my specific written consent or a court order. Violations may result in civil and criminal penalties under federal law.</p>
          <p>3. I understand that the Department of Behavioral Health and Developmental Disabilities will not condition my treatment, payment, or eligibility for any applicable benefits on whether I provide authorization for the requested release of information.</p>
          <p>4. I intend this document to be a valid authorization conforming to all requirements of the Privacy Rule and State law, and understand that my authorization will remain in effect for: (PLEASE CHECK ONE)</p>
        </div>
        <p class="pr-field"><span id="prRoiDurationOneYear" class="pr-check"></span> one (1) year. &nbsp; <span id="prRoiDurationService" class="pr-check"></span> the period necessary to complete all transactions on matters related to services provided to me.</p>
        <hr class="pr-separator" />
        <div class="pr-sig-block">
          <p class="pr-label">Client Signature</p>
          <div class="pr-sig-row">
            <img id="prRoiClientSig" class="pr-sig-img" alt="" />
            <div class="pr-sig-meta">
              <p>Name: <span id="prRoiClientPrintedName"></span></p>
              <p>Date: <span id="prRoiClientSigDate"></span></p>
            </div>
          </div>
        </div>
        <div class="pr-sig-block">
          <p class="pr-label">Parent/Representative Signature</p>
          <div class="pr-sig-row">
            <img id="prRoiParentSig" class="pr-sig-img" alt="" />
            <div class="pr-sig-meta">
              <p>Name: <span id="prRoiParentPrintedName"></span></p>
              <p>Date: <span id="prRoiParentSigDate"></span></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Notice Print-Ready Div (hidden, rendered by html2pdf) -->
      <div id="printNotice" class="print-ready" aria-hidden="true">
        <h2 class="pr-title">Notice of Privacy Practices</h2>
        <p><strong>Client:</strong> <span id="prNoticeClientName"></span></p>
        <p><strong>DOB:</strong> <span id="prNoticeClientDob"></span></p>
        <p><strong>Staff:</strong> <span id="prNoticeStaffName"></span></p>
        <div class="pr-notice-section">
          <h3>Section 1 – Privacy Rights and Uses</h3>
          <p id="prNoticeSummary1"></p>
          <p class="pr-legal-text" id="prNoticeLegal1"></p>
        </div>
        <div class="pr-notice-section">
          <h3>Section 2 – How Information May Be Shared</h3>
          <p id="prNoticeSummary2"></p>
          <p class="pr-legal-text" id="prNoticeLegal2"></p>
        </div>
        <div class="pr-notice-section">
          <h3>Section 3 – Client Acknowledgement and Contact</h3>
          <p id="prNoticeSummary3"></p>
          <p class="pr-legal-text" id="prNoticeLegal3"></p>
        </div>
        <hr class="pr-separator" />
        <div class="pr-sig-block">
          <p class="pr-label">Client Signature</p>
          <div class="pr-sig-row">
            <img id="prNoticeClientSig" class="pr-sig-img" alt="" />
            <div class="pr-sig-meta">
              <p>Date: <span id="prNoticeDate"></span></p>
              <p>Time: <span id="prNoticeTime"></span></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="vendor/html2pdf.bundle.min.js"></script>
    <script type="module" src="src/main.js"></script>
  </body>
</html>
